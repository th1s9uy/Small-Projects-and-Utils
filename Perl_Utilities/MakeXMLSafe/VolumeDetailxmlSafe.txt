query = "            SELECT " 
query = query &amp; "                           MPBD.BUSINESS_DIVISION_CODE,   "
query = query &amp; "                           INITCAP(MPBD.BUSINESS_DIVISION_DESCR)AS BusinessDivisionDescr,   "
query = query &amp; "                          (MPBD.BUSINESS_DIVISION_CODE ||'--'||INITCAP(MPBD.BUSINESS_DIVISION_DESCR))AS BusinessDivisionCodeDescr,   "
query = query &amp; "                           M.REGION_CODE,   "
query = query &amp; "                           M.REGION_DESCR,    "
query = query &amp; "                           P.MINOR_LINE_CODE,   "
query = query &amp; "                           INITCAP(P.MINOR_LINE_DESCR) AS MINOR_LINE_DESCR,     "
query = query &amp; "                           IDS_MF.YEAR_DESCR,   "
query = query &amp; "                           IDS_MF.MONTH_DESCR,   "
query = query &amp; "                          SUM(IDS_MF.MF_Pounds_Shipped +   "
query = query &amp; "                                 IDS_MF.IDS_Pounds_Shipped) "
query = query &amp; "                                       AS TOTAL_POUNDS_SHIPPED,                  "
query = query &amp; "                           SUM(IDS_MF.MF_Gross_Sales_Amount  "
query = query &amp; "						       - IDS_MF.MF_Allow_Amount  "
query = query &amp; "							   - IDS_MF.MF_Off_Invoice_Amount  "
query = query &amp; "							   + IDS_MF.MF_Revenue_Adjustment  "
query = query &amp; "							   + IDS_MF.IDS_Indirect_Sales_Amount)   "
query = query &amp; "                                      AS NET_RECEIVABLE_DOLLAR              "
query = query &amp; "                              FROM(   "
query = query &amp; "                              /*Begin Sub query*/   "
query = query &amp; "                        SELECT   "
query = query &amp; "                         MPBD1.BUSINESS_DIVISION_CODE    "
query = query &amp; "                        ,MPBD1.BUSINESS_DIVISION_DESCR   "
query = query &amp; "                        ,MPBD1.RESTATED_MARKET_KEY   "
query = query &amp; "                        ,MPBD1.RESTATED_PRODUCT_KEY   "
query = query &amp; "                        ,WD.YEAR_DESCR   "
query = query &amp; "                        ,WD.MONTH_DESCR   "
query = query &amp; "                        ,WD.FISCAL_MONTH_NUMBER   "
query = query &amp; "                        ,sum(MF.POUNDS_SHIPPED) AS MF_Pounds_Shipped    "
query = query &amp; "                        ,sum(MF.GROSS_SALES_AMOUNT) AS MF_Gross_Sales_Amount   "
query = query &amp; "                        ,sum(MF.ALLOW_AMOUNT) AS MF_Allow_Amount   "
query = query &amp; "                        ,sum(mf.gross_sales_variance) AS MF_Revenue_Adjustment   "
query = query &amp; "                        ,sum(MF.OFF_INVOICE_AMOUNT) AS MF_Off_Invoice_Amount   "
query = query &amp; "                        ,0 AS IDS_Pounds_Shipped   "
query = query &amp; "                        ,0 AS IDS_Indirect_Sales_Amount   "
query = query &amp; "                        FROM  TDW_OWNER.RESTATED_MKT_PRD_BUS_DIV_DIM MPBD1   "
query = query &amp; "                        ,TDW_OWNER.RESTATED_MARKET M1   "
query = query &amp; "                        ,TDW_OWNER.RESTATED_PRODUCT P1   "
query = query &amp; "                        ,tdw_owner.ta_margin_fact_view mf/*newly added*/  "
query = query &amp; "                        ,tdw_owner.week_dim wd /*new added*/  "
query = query &amp; "                        WHERE    "
query = query &amp; "                            MF.RESTATED_MARKET_KEY = M1.RESTATED_MARKET_KEY    "
query = query &amp; "                        AND MF.RESTATED_PRODUCT_KEY = P1.RESTATED_PRODUCT_KEY    "
query = query &amp; "                        AND MF.RESTATED_MARKET_KEY = MPBD1.RESTATED_MARKET_KEY   "
query = query &amp; "                        AND MF.RESTATED_PRODUCT_KEY = MPBD1.RESTATED_PRODUCT_KEY   "
query = query &amp; "                        AND To_DATE(mf.week_key,'YYYYMMDD')  = wd.week_ending_date /* newly added*/  "
query = query &amp; "                        AND(MPBD1.BUSINESS_DIVISION_CODE IN ('F01', 'F03', 'F04', 'F08', 'F11', 'F12', 'F15'))    "
query = query &amp; "                        AND (M1.SELLING_GROUP_CODE IN ('119000','125000','610000','800000','423000'))   "
query = query &amp; "                        AND (wd.YEAR_DESCR IN (:p_Year)) /*newly added             */  "
query = query &amp; "                        AND wd.FISCAL_MONTH_NUMBER &lt;= :p_Month /*newly added   */  "
query = query &amp; "                        AND (MPBD1.BUSINESS_DIVISION_CODE IN(:p_BusinessDivision))    "
query = query &amp; "                        AND (M1.DIVISION_CODE IN(:p_SalesDivision))    "
query = query &amp; "                        AND (M1.REGION_CODE IN(:p_SalesRegion))    "
query = query &amp; "                        AND (M1.PRIMARY_BROKER_CODE IN(:p_PrimaryBroker))    "
query = query &amp; "                        Group by   "
query = query &amp; "                        MPBD1.BUSINESS_DIVISION_CODE    "
query = query &amp; "                        ,MPBD1.BUSINESS_DIVISION_DESCR   "
query = query &amp; "                        ,MPBD1.RESTATED_MARKET_KEY   "
query = query &amp; "                        ,MPBD1.RESTATED_PRODUCT_KEY   "
query = query &amp; "                        ,wd.year_descr /*newly added*/  "
query = query &amp; "                        ,wd.month_descr /*newly added*/  "
query = query &amp; "                        ,wd.FISCAL_MONTH_NUMBER /*newly added*/  "
query = query &amp; "                        UNION    "
query = query &amp; "                        SELECT  /*+ RULE */   "
query = query &amp; "                         MPBD1.BUSINESS_DIVISION_CODE    "
query = query &amp; "                        ,MPBD1.BUSINESS_DIVISION_DESCR   "
query = query &amp; "                        ,MPBD1.RESTATED_MARKET_KEY   "
query = query &amp; "                        ,MPBD1.RESTATED_PRODUCT_KEY   "
query = query &amp; "                        ,MD.YEAR_DESCR   "
query = query &amp; "                        ,MD.MONTH_DESCR   "
query = query &amp; "                        ,MD.FISCAL_MONTH_NUMBER   "
query = query &amp; "                        ,0 AS MF_Pounds_Shipped   "
query = query &amp; "                        ,0 AS MF_Gross_Sales_Amount   "
query = query &amp; "                        ,0 AS MF_Allow_Amount   "
query = query &amp; "                        ,0 AS MF_Revenue_Adjustment   "
query = query &amp; "                        ,0 AS MF_Off_Invoice_Amount   "
query = query &amp; "                        ,sum(IDS.POUNDS_SHIPPED) AS IDS_Pounds_Shipped   "
query = query &amp; "                        ,sum(IDS.INDIRECT_SALES_AMOUNT) AS IDS_Indirect_Sales_Amount   "
query = query &amp; "                        FROM  TDW_OWNER.RESTATED_MKT_PRD_BUS_DIV_DIM MPBD1   "
query = query &amp; "                        ,TDW_OWNER.RESTATED_MARKET M1   "
query = query &amp; "                        ,TDW_OWNER.MONTH_DIM MD   "
query = query &amp; "                        ,TDW_OWNER.RESTATED_PRODUCT P1   "
query = query &amp; "                        ,TDW_OWNER.INDIRECT_SALES IDS   "
query = query &amp; "                        ,TDW_OWNER.WEEK_DIM W    "
query = query &amp; "                        WHERE    "
query = query &amp; "                            IDS.RESTATED_MARKET_KEY = M1.RESTATED_MARKET_KEY   "
query = query &amp; "                        AND IDS.RESTATED_PRODUCT_KEY = P1.RESTATED_PRODUCT_KEY   "
query = query &amp; "                        AND IDS.RESTATED_MARKET_KEY = MPBD1.RESTATED_MARKET_KEY   "
query = query &amp; "                        AND IDS.RESTATED_PRODUCT_KEY = MPBD1.RESTATED_PRODUCT_KEY   "
query = query &amp; "                        AND IDS.WEEK_KEY = W.WEEK_KEY    "
query = query &amp; "                        AND W.MONTH_ENDING_DATE = MD.MONTH_ENDING_DATE   "
query = query &amp; "                        AND(MPBD1.BUSINESS_DIVISION_CODE IN ('F01', 'F03', 'F04', 'F08', 'F11', 'F12', 'F15'))    "
query = query &amp; "                        AND (M1.SELLING_GROUP_CODE IN ('119000','125000','610000','800000','423000'))   "
query = query &amp; "                        AND (MD.YEAR_DESCR IN(:p_Year))                  "
query = query &amp; "                        AND (MD.FISCAL_MONTH_NUMBER= (:p_Month))    "
query = query &amp; "                        AND (MPBD1.BUSINESS_DIVISION_CODE IN(:p_BusinessDivision))    "
query = query &amp; "                        AND (M1.DIVISION_CODE IN(:p_SalesDivision))    "
query = query &amp; "                        AND (M1.REGION_CODE IN(:p_SalesRegion))    "
query = query &amp; "                        AND (M1.PRIMARY_BROKER_CODE IN(:p_PrimaryBroker))    "
query = query &amp; "                        group by   "
query = query &amp; "                        MPBD1.BUSINESS_DIVISION_CODE    "
query = query &amp; "                        ,MPBD1.BUSINESS_DIVISION_DESCR   "
query = query &amp; "                        ,MPBD1.RESTATED_MARKET_KEY   "
query = query &amp; "                        ,MPBD1.RESTATED_PRODUCT_KEY   "
query = query &amp; "                        ,MD.YEAR_DESCR   "
query = query &amp; "                        ,MD.MONTH_DESCR   "
query = query &amp; "                        ,MD.FISCAL_MONTH_NUMBER   "
query = query &amp; "                           )/*end sub query*/   "
query = query &amp; "                         IDS_MF   "
query = query &amp; "                        ,TDW_OWNER.RESTATED_MKT_PRD_BUS_DIV_DIM MPBD   "
query = query &amp; "                        ,TDW_OWNER.RESTATED_MARKET M   "
query = query &amp; "                        ,TDW_OWNER.RESTATED_PRODUCT P   "
query = query &amp; "                        WHERE    "
query = query &amp; "                            IDS_MF.RESTATED_MARKET_KEY  =  MPBD.RESTATED_MARKET_KEY   "
query = query &amp; "                        AND IDS_MF.RESTATED_PRODUCT_KEY =  MPBD.RESTATED_PRODUCT_KEY   "
query = query &amp; "                        AND IDS_MF.RESTATED_MARKET_KEY = M.RESTATED_MARKET_KEY   "
query = query &amp; "                        AND IDS_MF.RESTATED_PRODUCT_KEY = P.RESTATED_PRODUCT_KEY   "
query = query &amp; "                        AND(MPBD.BUSINESS_DIVISION_CODE IN ('F01', 'F03', 'F04', 'F08', 'F11', 'F12', 'F15'))    "
query = query &amp; "                        AND (M.SELLING_GROUP_CODE IN ('119000','125000','610000','800000','423000'))   "
query = query &amp; "                        AND (IDS_MF.YEAR_DESCR IN(:p_Year))                  "
query = query &amp; "                        AND (IDS_MF.FISCAL_MONTH_NUMBER = (:p_Month))    "
query = query &amp; "                        AND (MPBD.BUSINESS_DIVISION_CODE IN(:p_BusinessDivision))    "
query = query &amp; "                        AND (M.DIVISION_CODE IN(:p_SalesDivision))    "
query = query &amp; "                        AND (M.REGION_CODE IN(:p_SalesRegion))    "
query = query &amp; "                        AND (M.PRIMARY_BROKER_CODE IN(:p_PrimaryBroker))    "
query = query &amp; "                            "
query = query &amp; "                         GROUP BY   "
query = query &amp; "                           MPBD.BUSINESS_DIVISION_CODE,   "
query = query &amp; "                           INITCAP(MPBD.BUSINESS_DIVISION_DESCR),   "
query = query &amp; "                           M.REGION_CODE,   "
query = query &amp; "                           M.REGION_DESCR,   "
query = query &amp; "                           P.MINOR_LINE_CODE,   "
query = query &amp; "                           INITCAP(P.MINOR_LINE_DESCR),     "
query = query &amp; "                           IDS_MF.YEAR_DESCR,   "
query = query &amp; "                           IDS_MF.MONTH_DESCR   "
query = query &amp; "                           ORDER BY BusinessDivisionDescr,MINOR_LINE_CODE "