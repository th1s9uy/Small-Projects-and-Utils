    Function getExpenseDetailQuery(ByVal grouping As String, ByVal month As String, ByVal year As String, ByVal bd As String, ByVal sd As String, ByVal sr As String, ByVal pb As String, ByVal vp As String) As String
        Dim query As String

        If (grouping = "RSM") Then

            query = "/* Formatted on 2009/03/12 09:47 (Formatter Plus v4.8.8) */"
            query = query & "SELECT   CASE "
            query = query & "            WHEN (sc.spend_base_seq IN (1, 2, 3, 4, 5)) "
            query = query & "               THEN 'Distributor' "
            query = query & "            WHEN (sc.spend_base_seq = 6) "
            query = query & "               THEN 'Operator' "
            query = query & "         END AS businessunit, "
            query = query & "         INITCAP (mpbd.business_division_descr) AS businessdivisiondescr, "
            query = query & "         sc.spend_base_descr, "
            query = query & "         sc.spend_base_seq, "
            query = query & "         sc.spend_subcategory_descr, "
            query = query & "         sc.spend_subcategory_seq, "
            query = query & "         m.REGION_CODE, "
            query = query & "         m.REGION_DESCR, "
            query = query & "         m.primary_broker_code, "
            query = query & "         m.primary_broker_code || '/*' || m.primary_broker_descr*/ "
            query = query & "                                                 AS primary_broker_code_descr, "
            query = query & "         CASE "
            query = query & "            WHEN (LENGTH (TRIM (s.spend_request_id))) > 0 "
            query = query & "               THEN s.spend_request_id "
            query = query & "            ELSE 'Not Available' "
            query = query & "         END AS spend_request_id, "
            query = query & "         a.acct_class_descr AS expense_descr, "
            query = query & "         INITCAP (o.operator_name) AS operator_name, "
            query = query & "         INITCAP (pay.payee_name), "
            query = query & "         md.year_descr, "
            query = query & "         md.month_descr, "
            query = query & "         SUM (epf.expense_amt) AS expense_amt "
            query = query & "    FROM tdw_owner.restated_mkt_prd_bus_div_dim mpbd, "
            query = query & "         tdw_owner.expense_payment_fact epf, "
            query = query & "         tdw_owner.fsv_spend_category sc, "
            query = query & "         tdw_owner.restated_market m, "
            query = query & "         tdw_owner.month_dim md, "
            query = query & "         tdw_owner.restated_product p, "
            query = query & "         tdw_owner.acct_dim a, "
            query = query & "         tdw_owner.expense_type et, "
            query = query & "         tdw_owner.spend_request_dim s, "
            query = query & "         tdw_owner.operator_dim o, "
            query = query & "         tdw_owner.day_dim d1, "
            query = query & "         tdw_owner.day_dim d2, "
            query = query & "         tdw_owner.expense_attribute_dim ead, "
            query = query & "         tdw_owner.expense_payee_dim pay "
            query = query & "   WHERE mpbd.restated_mkt_prd_bus_div_key = epf.restated_mkt_prd_bus_div_key "
            query = query & "     AND epf.expense_type_key = sc.expense_type_key "
            query = query & "     AND epf.acct_key = sc.acct_key "
            query = query & "     AND epf.restated_market_key = m.restated_market_key "
            query = query & "     AND epf.month_key = md.month_key "
            query = query & "     AND epf.restated_product_key = p.restated_product_key "
            query = query & "     AND epf.acct_key = a.acct_key "
            query = query & "     AND epf.expense_type_key = et.expense_type_key "
            query = query & "     AND epf.spend_request_key = s.spend_request_key "
            query = query & "     AND epf.operator_key = o.operator_key "
            query = query & "     AND epf.report_period_begin_day_key = d1.day_key "
            query = query & "     AND epf.report_period_end_day_key = d2.day_key "
            query = query & "     AND epf.expense_attribute_key = ead.expense_attribute_key "
            query = query & "     AND epf.expense_payee_key = pay.expense_payee_key "
            query = query & "     AND sc.spend_base_seq <> 0 "
            query = query & "     AND sc.spend_subcategory_seq <> 0 "
            query = query & "     AND (mpbd.business_division_code IN ('F01', 'F03', 'F04', 'F08', 'F15') "
            query = query & "         ) "
            query = query & "     AND (m.selling_group_code IN "
            query = query & "                           ('119000', '125000', '610000', '800000', '423000') "
            query = query & "         ) "
            query = query & "     AND (md.year_descr IN (:p_year)) "
            query = query & "     AND (md.fiscal_month_number = (:p_month)) "
            query = query & "     AND (mpbd.business_division_code IN (:p_businessdivision)) "
            query = query & "     AND (m.division_code IN (:p_salesdivision)) "
            query = query & "     AND (m.region_code IN (:p_salesregion)) "
            query = query & "     AND (m.primary_broker_code IN (:p_primarybroker)) "
            query = query & "GROUP BY INITCAP (mpbd.business_division_descr), "
            query = query & "         sc.spend_base_descr, "
            query = query & "         sc.spend_base_seq, "
            query = query & "         sc.spend_subcategory_descr, "
            query = query & "         sc.spend_subcategory_seq, "
            query = query & "         m.REGION_CODE, "
            query = query & "         m.REGION_DESCR, "
            query = query & "         m.primary_broker_code, "
            query = query & "         m.primary_broker_code || '/*' || m.primary_broker_descr,*/ "
            query = query & "         s.spend_request_id, "
            query = query & "         a.acct_class_descr, "
            query = query & "         INITCAP (o.operator_name), "
            query = query & "         INITCAP (pay.payee_name), "
            query = query & "         md.year_descr, "
            query = query & "         md.month_descr "
            query = query & "UNION "
            query = query & "SELECT   CASE "
            query = query & "            WHEN (sc.spend_base_seq IN (1, 2, 3, 4, 5)) "
            query = query & "               THEN 'Distributor' "
            query = query & "            WHEN (sc.spend_base_seq = 6) "
            query = query & "               THEN 'Operator' "
            query = query & "         END AS businessunit, "
            query = query & "         'Total Value Added' AS businessdivisiondescr, "
            query = query & "         sc.spend_base_descr, "
            query = query & "         sc.spend_base_seq, "
            query = query & "         sc.spend_subcategory_descr, "
            query = query & "         sc.spend_subcategory_seq, "
            query = query & "         m.REGION_CODE, "
            query = query & "         m.REGION_DESCR, "
            query = query & "         m.primary_broker_code, "
            query = query & "         m.primary_broker_code || '/*' || m.primary_broker_descr*/ "
            query = query & "                                                 AS primary_broker_code_descr, "
            query = query & "         CASE "
            query = query & "            WHEN (LENGTH (TRIM (s.spend_request_id))) > 0 "
            query = query & "               THEN s.spend_request_id "
            query = query & "            ELSE 'Not Available' "
            query = query & "         END AS spend_request_id, "
            query = query & "         a.acct_class_descr AS expense_descr, "
            query = query & "         INITCAP (o.operator_name) AS operator_name, "
            query = query & "         INITCAP (pay.payee_name), "
            query = query & "         md.year_descr, "
            query = query & "         md.month_descr, "
            query = query & "         SUM (epf.expense_amt) AS expense_amt "
            query = query & "    FROM tdw_owner.restated_mkt_prd_bus_div_dim mpbd, "
            query = query & "         tdw_owner.expense_payment_fact epf, "
            query = query & "         tdw_owner.fsv_spend_category sc, "
            query = query & "         tdw_owner.restated_market m, "
            query = query & "         tdw_owner.month_dim md, "
            query = query & "         tdw_owner.restated_product p, "
            query = query & "         tdw_owner.acct_dim a, "
            query = query & "         tdw_owner.expense_type et, "
            query = query & "         tdw_owner.spend_request_dim s, "
            query = query & "         tdw_owner.operator_dim o, "
            query = query & "         tdw_owner.day_dim d1, "
            query = query & "         tdw_owner.day_dim d2, "
            query = query & "         tdw_owner.expense_attribute_dim ead, "
            query = query & "         tdw_owner.expense_payee_dim pay "
            query = query & "   WHERE mpbd.restated_mkt_prd_bus_div_key = epf.restated_mkt_prd_bus_div_key "
            query = query & "     AND epf.expense_type_key = sc.expense_type_key "
            query = query & "     AND epf.acct_key = sc.acct_key "
            query = query & "     AND epf.restated_market_key = m.restated_market_key "
            query = query & "     AND epf.month_key = md.month_key "
            query = query & "     AND epf.restated_product_key = p.restated_product_key "
            query = query & "     AND epf.acct_key = a.acct_key "
            query = query & "     AND epf.expense_type_key = et.expense_type_key "
            query = query & "     AND epf.spend_request_key = s.spend_request_key "
            query = query & "     AND epf.operator_key = o.operator_key "
            query = query & "     AND epf.report_period_begin_day_key = d1.day_key "
            query = query & "     AND epf.report_period_end_day_key = d2.day_key "
            query = query & "     AND epf.expense_attribute_key = ead.expense_attribute_key "
            query = query & "     AND epf.expense_payee_key = pay.expense_payee_key "
            query = query & "     AND sc.spend_base_seq <> 0 "
            query = query & "     AND sc.spend_subcategory_seq <> 0 "
            query = query & "     AND (mpbd.business_division_code IN ('F01', 'F08', 'F15')) "
            query = query & "     AND (m.selling_group_code IN "
            query = query & "                           ('119000', '125000', '610000', '800000', '423000') "
            query = query & "         ) "
            query = query & "     AND (md.year_descr IN (:p_year)) "
            query = query & "     AND (md.fiscal_month_number = (:p_month)) "
            query = query & "     AND (mpbd.business_division_code IN (:p_businessdivision)) "
            query = query & "     AND (m.division_code IN (:p_salesdivision)) "
            query = query & "     AND (m.region_code IN (:p_salesregion)) "
            query = query & "     AND (m.primary_broker_code IN (:p_primarybroker)) "
            query = query & "GROUP BY 'Total Value Added', "
            query = query & "         sc.spend_base_descr, "
            query = query & "         sc.spend_base_seq, "
            query = query & "         sc.spend_subcategory_descr, "
            query = query & "         sc.spend_subcategory_seq, "
            query = query & "         m.REGION_CODE, "
            query = query & "         m.REGION_DESCR, "
            query = query & "         m.primary_broker_code, "
            query = query & "         m.primary_broker_code || '/*' || m.primary_broker_descr,*/ "
            query = query & "         s.spend_request_id, "
            query = query & "         a.acct_class_descr, "
            query = query & "         INITCAP (o.operator_name), "
            query = query & "         INITCAP (pay.payee_name), "
            query = query & "         md.year_descr, "
            query = query & "         md.month_descr "
            query = query & "UNION "
            query = query & "SELECT   CASE "
            query = query & "            WHEN (sc.spend_base_seq IN (1, 2, 3, 4, 5)) "
            query = query & "               THEN 'Distributor' "
            query = query & "            WHEN (sc.spend_base_seq = 6) "
            query = query & "               THEN 'Operator' "
            query = query & "         END AS businessunit, "
            query = query & "         'Total Market/CVP' AS businessdivisiondescr, "
            query = query & "         sc.spend_base_descr, "
            query = query & "         sc.spend_base_seq, "
            query = query & "         sc.spend_subcategory_descr, "
            query = query & "         sc.spend_subcategory_seq, "
            query = query & "         m.REGION_CODE, "
            query = query & "         m.REGION_DESCR, "
            query = query & "         m.primary_broker_code, "
            query = query & "         m.primary_broker_code || '/*' || m.primary_broker_descr*/ "
            query = query & "                                                 AS primary_broker_code_descr, "
            query = query & "         CASE "
            query = query & "            WHEN (LENGTH (TRIM (s.spend_request_id))) > 0 "
            query = query & "               THEN s.spend_request_id "
            query = query & "            ELSE 'Not Available' "
            query = query & "         END AS spend_request_id, "
            query = query & "         a.acct_class_descr AS expense_descr, "
            query = query & "         INITCAP (o.operator_name) AS operator_name, "
            query = query & "         INITCAP (pay.payee_name), "
            query = query & "         md.year_descr, "
            query = query & "         md.month_descr, "
            query = query & "         SUM (epf.expense_amt) AS expense_amt "
            query = query & "    FROM tdw_owner.restated_mkt_prd_bus_div_dim mpbd, "
            query = query & "         tdw_owner.expense_payment_fact epf, "
            query = query & "         tdw_owner.fsv_spend_category sc, "
            query = query & "         tdw_owner.restated_market m, "
            query = query & "         tdw_owner.month_dim md, "
            query = query & "         tdw_owner.restated_product p, "
            query = query & "         tdw_owner.acct_dim a, "
            query = query & "         tdw_owner.expense_type et, "
            query = query & "         tdw_owner.spend_request_dim s, "
            query = query & "         tdw_owner.operator_dim o, "
            query = query & "         tdw_owner.day_dim d1, "
            query = query & "         tdw_owner.day_dim d2, "
            query = query & "         tdw_owner.expense_attribute_dim ead, "
            query = query & "         tdw_owner.expense_payee_dim pay "
            query = query & "   WHERE mpbd.restated_mkt_prd_bus_div_key = epf.restated_mkt_prd_bus_div_key "
            query = query & "     AND epf.expense_type_key = sc.expense_type_key "
            query = query & "     AND epf.acct_key = sc.acct_key "
            query = query & "     AND epf.restated_market_key = m.restated_market_key "
            query = query & "     AND epf.month_key = md.month_key "
            query = query & "     AND epf.restated_product_key = p.restated_product_key "
            query = query & "     AND epf.acct_key = a.acct_key "
            query = query & "     AND epf.expense_type_key = et.expense_type_key "
            query = query & "     AND epf.spend_request_key = s.spend_request_key "
            query = query & "     AND epf.operator_key = o.operator_key "
            query = query & "     AND epf.report_period_begin_day_key = d1.day_key "
            query = query & "     AND epf.report_period_end_day_key = d2.day_key "
            query = query & "     AND epf.expense_attribute_key = ead.expense_attribute_key "
            query = query & "     AND epf.expense_payee_key = pay.expense_payee_key "
            query = query & "     AND sc.spend_base_seq <> 0 "
            query = query & "     AND sc.spend_subcategory_seq <> 0 "
            query = query & "     AND (mpbd.business_division_code IN ('F03', 'F04')) "
            query = query & "     AND (m.selling_group_code IN "
            query = query & "                           ('119000', '125000', '610000', '800000', '423000') "
            query = query & "         ) "
            query = query & "     AND (md.year_descr IN (:p_year)) "
            query = query & "     AND (md.fiscal_month_number = (:p_month)) "
            query = query & "     AND (mpbd.business_division_code IN (:p_businessdivision)) "
            query = query & "     AND (m.division_code IN (:p_salesdivision)) "
            query = query & "     AND (m.region_code IN (:p_salesregion)) "
            query = query & "     AND (m.primary_broker_code IN (:p_primarybroker)) "
            query = query & "GROUP BY 'Total Market/CVP', "
            query = query & "         sc.spend_base_descr, "
            query = query & "         sc.spend_base_seq, "
            query = query & "         sc.spend_subcategory_descr, "
            query = query & "         sc.spend_subcategory_seq, "
            query = query & "         m.REGION_CODE, "
            query = query & "         m.REGION_DESCR, "
            query = query & "         m.primary_broker_code, "
            query = query & "         m.primary_broker_code || '/*' || m.primary_broker_descr,*/ "
            query = query & "         s.spend_request_id, "
            query = query & "         a.acct_class_descr, "
            query = query & "         INITCAP (o.operator_name), "
            query = query & "         INITCAP (pay.payee_name), "
            query = query & "         md.year_descr, "
            query = query & "         md.month_descr "
            query = query & "UNION "
            query = query & "SELECT   CASE "
            query = query & "            WHEN (sc.spend_base_seq IN (1, 2, 3, 4, 5)) "
            query = query & "               THEN 'Distributor' "
            query = query & "            WHEN (sc.spend_base_seq = 6) "
            query = query & "               THEN 'Operator' "
            query = query & "         END AS businessunit, "
            query = query & "         'Total Customer' AS businessdivisiondescr, "
            query = query & "         sc.spend_base_descr, "
            query = query & "         sc.spend_base_seq, "
            query = query & "         sc.spend_subcategory_descr, "
            query = query & "         sc.spend_subcategory_seq, "
            query = query & "         m.REGION_CODE, "
            query = query & "         m.REGION_DESCR, "
            query = query & "         m.primary_broker_code, "
            query = query & "         m.primary_broker_code || '/*' || m.primary_broker_descr*/ "
            query = query & "                                                 AS primary_broker_code_descr, "
            query = query & "         CASE "
            query = query & "            WHEN (LENGTH (TRIM (s.spend_request_id))) > 0 "
            query = query & "               THEN s.spend_request_id "
            query = query & "            ELSE 'Not Available' "
            query = query & "         END AS spend_request_id, "
            query = query & "         a.acct_class_descr AS expense_descr, "
            query = query & "         INITCAP (o.operator_name) AS operator_name, "
            query = query & "         INITCAP (pay.payee_name), "
            query = query & "         md.year_descr, "
            query = query & "         md.month_descr, "
            query = query & "         SUM (epf.expense_amt) AS expense_amt "
            query = query & "    FROM tdw_owner.restated_mkt_prd_bus_div_dim mpbd, "
            query = query & "         tdw_owner.expense_payment_fact epf, "
            query = query & "         tdw_owner.fsv_spend_category sc, "
            query = query & "         tdw_owner.restated_market m, "
            query = query & "         tdw_owner.month_dim md, "
            query = query & "         tdw_owner.restated_product p, "
            query = query & "         tdw_owner.acct_dim a, "
            query = query & "         tdw_owner.expense_type et, "
            query = query & "         tdw_owner.spend_request_dim s, "
            query = query & "         tdw_owner.operator_dim o, "
            query = query & "         tdw_owner.day_dim d1, "
            query = query & "         tdw_owner.day_dim d2, "
            query = query & "         tdw_owner.expense_attribute_dim ead, "
            query = query & "         tdw_owner.expense_payee_dim pay "
            query = query & "   WHERE mpbd.restated_mkt_prd_bus_div_key = epf.restated_mkt_prd_bus_div_key "
            query = query & "     AND epf.expense_type_key = sc.expense_type_key "
            query = query & "     AND epf.acct_key = sc.acct_key "
            query = query & "     AND epf.restated_market_key = m.restated_market_key "
            query = query & "     AND epf.month_key = md.month_key "
            query = query & "     AND epf.restated_product_key = p.restated_product_key "
            query = query & "     AND epf.acct_key = a.acct_key "
            query = query & "     AND epf.expense_type_key = et.expense_type_key "
            query = query & "     AND epf.spend_request_key = s.spend_request_key "
            query = query & "     AND epf.operator_key = o.operator_key "
            query = query & "     AND epf.report_period_begin_day_key = d1.day_key "
            query = query & "     AND epf.report_period_end_day_key = d2.day_key "
            query = query & "     AND epf.expense_attribute_key = ead.expense_attribute_key "
            query = query & "     AND epf.expense_payee_key = pay.expense_payee_key "
            query = query & "     AND sc.spend_base_seq <> 0 "
            query = query & "     AND sc.spend_subcategory_seq <> 0 "
            query = query & "     AND (mpbd.business_division_code IN ('F01', 'F03', 'F04', 'F08', 'F15') "
            query = query & "         ) "
            query = query & "     AND (m.selling_group_code IN "
            query = query & "                           ('119000', '125000', '610000', '800000', '423000') "
            query = query & "         ) "
            query = query & "     AND (md.year_descr IN (:p_year)) "
            query = query & "     AND (md.fiscal_month_number = (:p_month)) "
            query = query & "     AND (mpbd.business_division_code IN (:p_businessdivision)) "
            query = query & "     AND (m.division_code IN (:p_salesdivision)) "
            query = query & "     AND (m.region_code IN (:p_salesregion)) "
            query = query & "     AND (m.primary_broker_code IN (:p_primarybroker)) "
            query = query & "GROUP BY 'Total Customer', "
            query = query & "         sc.spend_base_descr, "
            query = query & "         sc.spend_base_seq, "
            query = query & "         sc.spend_subcategory_descr, "
            query = query & "         sc.spend_subcategory_seq, "
            query = query & "         m.REGION_CODE, "
            query = query & "         m.REGION_DESCR, "
            query = query & "         m.primary_broker_code, "
            query = query & "         m.primary_broker_code || '/*' || m.primary_broker_descr,*/ "
            query = query & "         s.spend_request_id, "
            query = query & "         a.acct_class_descr, "
            query = query & "         INITCAP (o.operator_name), "
            query = query & "         INITCAP (pay.payee_name), "
            query = query & "         md.year_descr, "
            query = query & "         md.month_descr "
            query = query & "ORDER BY businessdivisiondescr, "
            query = query & "         spend_base_seq, "
            query = query & "         spend_subcategory_seq, "
            query = query & "         spend_request_id"

            year = quoteInnerStrings(year)
            bd = quoteInnerStrings(bd)
            sd = quoteInnerStrings(sd)
            sr = quoteInnerStrings(sr)
            pb = quoteInnerStrings(pb)
            vp = quoteInnerStrings(vp)

            query = Replace(query, ":p_Month", month)
            query = Replace(query, ":p_year", year)
            query = Replace(query, ":p_businessdivision", bd)
            query = Replace(query, ":p_salesdivision", sd)
            query = Replace(query, ":p_salesregion", sr)
            query = Replace(query, ":p_primarybroker", pb)
            query = Replace(query, ":vp", vp)
        Else
            query = "Select '' As businessunit, '' As bussinessdivisiondescr, '' As spend_base_descr, '' As spend_base_seq, "
            query = query & "'' As spend_subcategory_descr, '' As spend_subcategory_seq, '' As REGION_CODE, '' As REGION_DESCR, "
            query = query & "'' As primary_broker_code, '' As primary_broker_descr, '' As spend_request_id, '' As expense_descr, "
            query = query & "'' As operator_name, '' As payee_name, '' As year_descr, '' As month_descr, '' As expense_amt "
            query = query & "FROM Dual"
        End If


        Return query

    End Function